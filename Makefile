#	$NetBSD: Makefile,v 1.6 1999/09/06 12:52:11 tron Exp $
#
# build and install xsrc

all: all-xc all-contrib

all-xc:
.if exists(xc/xmakefile)
	@cd xc && ${MAKE} -f xmakefile World
.else
	@cd xc && ${MAKE} World
.endif

all-contrib:
.if !exists(contrib/Makefile)
	@cd contrib && PATH=../xc/config/imake:$$PATH \
	    sh ../xc/config/util/xmkmf -a ../xc ../contrib
.endif
	@cd contrib && ${MAKE}

install: install-xc install-contrib

install-xc:
	@cd xc && ${MAKE} install && ${MAKE} install.man

install-contrib:
	@cd contrib && ${MAKE} install && ${MAKE} install.man

clean:
	@cd xc && ${MAKE} clean
	@-cd contrib && ${MAKE} clean

cleandir distclean:
	find xc contrib -name .depend | xargs rm
	find xc contrib -name 'Makefile*' | \
	xargs grep -l "Makefile generated by imake" | xargs rm
	-rmdir xc/exports
	rm -f xc/xmakefile

build:
.if exists(xc/xmakefile)
	@echo ""
	@echo "Warning:  This does not rebuild from a clean tree."
	@echo "Use 'make clean' first if you want to start from scratch."
	@echo ""
.endif
	@${MAKE} all install
